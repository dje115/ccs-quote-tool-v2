# CCS Quote Tool v2 - v3.0.0 Forward Plan
**Version**: 3.0.0  
**Last Updated**: 2025-01-XX  
**Status**: Active Development Plan  
**Priority**: All agents MUST review this plan before starting work

---

## ðŸŽ¯ Vision

Deliver an AI-first revenue platform where every lead, quote, and ticket is rewritten, triaged, and actioned automatically so teams focus on relationships, not admin. Provide a single workspace tracking prospects from discovery through quoting, onboarding, and ongoing support without context switches.

---

## ðŸ”‘ Critical Multi-Tenant Requirements

### AI Prompt Management
- **ALL AI prompts MUST be stored in database on per-tenant basis**
- Prompts are scoped to `tenant_id` (system prompts have `tenant_id=None`)
- Every prompt modification creates new version in `AIPromptVersion` table
- Rollback capability required for any modification
- Admin portal UI for full CRUD with version history and rollback
- Prompt resolution priority:
  1. Tenant-specific prompt (highest priority)
  2. System prompt (fallback)

### Microsoft Copilot Integration
- **CRITICAL**: Add Microsoft Copilot as AI provider
- Important for Microsoft Graph integration and customer data control
- Add `ProviderType.MICROSOFT_COPILOT` to enum
- Implement Microsoft Graph authentication
- Support Microsoft Copilot-specific models and settings

### Navigation Structure
- **Three separate menu items**:
  - **Discoveries** (`/discoveries`) - Unknowns, unqualified prospects from campaigns
  - **Leads** (`/leads`) - Working to convert to customers, qualified prospects
  - **Customers** (`/customers`) - Active customers being dealt with
- Leads and Customers have same capabilities (can create quotes for both)
- Quote model must support both `customer_id` and `lead_id`

---

## Phase 0: Foundation & Critical Fixes

### 0.1 Complete Async Migration Verification
- Verify all endpoints use AsyncSession (audit remaining files)
- Document any acceptable sync exceptions (e.g., websocket.py)
- **Files**: All endpoint files in `backend/app/api/v1/endpoints/`

### 0.2 Security Audit - Tenant Isolation
- Comprehensive endpoint audit for `get_current_tenant()` usage
- Verify RLS policies are working correctly
- Test cross-tenant data access prevention
- **Files**: `backend/app/core/middleware.py`, all endpoint files

### 0.3 AI Prompt Fallback Verification
- Verify all services raise ValueError when prompts not found
- Test with empty database for proper error handling
- Update seed script to ensure all prompts are seeded
- **Files**: `backend/app/services/ai_*.py`, `backend/scripts/seed_ai_prompts.py`

---

## Phase 1: AI Orchestration Layer (Foundation)

### 1.1 Multi-Tenant AI Prompt Management
- **CRITICAL**: All AI prompts MUST be stored in database on per-tenant basis
- Ensure tenant isolation: prompts are scoped to `tenant_id` (system prompts have `tenant_id=None`)
- Implement versioning with rollback capability for any modification
- Admin portal UI for prompt management (create, edit, version, rollback)
- **Quote Builder Prompts**: Support multiple quote builder prompts per tenant:
  - Industry-specific prompts (IT/server, software, cabling, etc.)
  - Quote type-specific prompts
  - Tenant can have multiple prompts for different quote scenarios
- **Files**: `backend/app/models/ai_prompt.py` (verify tenant_id support), `admin-portal/src/views/AIPrompts.vue` (new)

### 1.2 Microsoft Copilot Integration
- Add Microsoft Copilot as AI provider (important for Microsoft Graph and data control)
- Add `ProviderType.MICROSOFT_COPILOT` to ProviderType enum
- Implement Microsoft Copilot API integration with Microsoft Graph authentication
- Support Microsoft Copilot-specific models and settings
- Add Microsoft Copilot to admin portal provider management
- **Files**: `backend/app/models/ai_provider.py` (extend ProviderType), `backend/app/services/microsoft_copilot_service.py` (new), `admin-portal/src/views/AIProviders.vue` (extend)

### 1.3 Core AI Orchestration Service
- Create centralized AI service managing prompts, providers, retry/backoff, safety filters
- Implement tenant-aware prompt resolution (tenant-specific prompts override system prompts)
- **Quote Builder Prompt Resolution**: Multi-level fallback for quote builder prompts:
  1. Tenant-specific + quote_type + industry
  2. Tenant-specific + quote_type (generic)
  3. Tenant-specific generic quote builder
  4. System prompt + quote_type + industry
  5. System generic quote builder
- Implement caching layer for AI responses (tenant-scoped cache keys)
- Add observability and logging for all AI calls (include tenant_id in logs)
- **Files**: `backend/app/services/ai_orchestration_service.py` (new)

### 1.4 AI Provider Routing & Management
- Extend provider routing to support multiple providers including Microsoft Copilot
- Implement fallback mechanisms (tenant provider -> system provider)
- Add provider health monitoring
- Support per-tenant provider preferences
- **Files**: `backend/app/services/ai_provider_service.py` (extend)

### 1.5 Prompt Versioning & Rollback
- Ensure all prompt modifications create new version in AIPromptVersion table
- Implement rollback endpoint to restore previous version
- Add version history UI in admin portal
- Add change notes/audit trail for each version
- **Files**: `backend/app/api/v1/endpoints/ai_prompts.py` (extend), `admin-portal/src/views/AIPromptVersions.vue` (new)

---

## Phase 2: AI Helpdesk Enhancements

### 2.1 Data Model Updates
- Add `original_description` and `improved_description` fields to Ticket model
- Add `ai_suggestions` JSON field for storing AI recommendations
- Add automation fields (auto_assign, auto_respond, SLA risk)
- **Files**: `backend/app/models/helpdesk.py` (extend)

### 2.2 AI Composer & Rewrite Flow
- Create dual-pane ticket composer component (left: agent text, right: AI rewrite)
- Implement auto-refresh on keystroke for AI rewrite
- Store both versions (original + improved)
- Add inline diff/highlight with Accept/Reject per paragraph
- **Files**: `frontend/src/components/TicketComposer.tsx` (new), `backend/app/api/v1/endpoints/helpdesk.py` (extend)

### 2.3 Auto Analysis & Next-Best Actions
- Trigger AI analysis on ticket creation and significant updates
- Feed AI with ticket metadata, related quotes/contracts, SLA targets, historical issues
- Store suggestions in `ai_suggestions` field
- Display actionable chips (Next Actions, Questions, Solutions) in ticket detail
- Implement one-click macros (apply tag/status, add note, draft reply)
- **Files**: `backend/app/services/helpdesk_ai_service.py` (new), `frontend/src/pages/TicketDetail.tsx` (extend)

### 2.4 Solution Workspace & Knowledge Surfacing
- Add right-hand panel showing recommended articles, similar solved tickets, product docs
- Implement confidence scores for suggestions
- Add "Insert into reply", "Attach to ticket", "Flag gap" actions
- **Files**: `frontend/src/components/TicketKnowledgePanel.tsx` (new), `backend/app/api/v1/endpoints/helpdesk.py` (extend)

### 2.5 Automation & SLA Intelligence
- AI auto-assigns ticket type, priority, and SLA breach risk
- Show SLA timers and risk indicators in list view
- Implement auto-response/close for low-complexity tickets with high confidence
- Add macro automation builder driven by AI suggestions
- **Files**: `backend/app/services/sla_intelligence_service.py` (new), `frontend/src/pages/Helpdesk.tsx` (extend)

### 2.6 Multi-Channel Timeline & Daily Summaries
- Merge emails, calls, tickets, quotes, AI-generated notes into chronological feed
- Generate daily AI summaries (status, blockers, recommended follow-ups)
- Add subscription controls for digest emails/Slack
- **Files**: `backend/app/services/activity_timeline_service.py` (new), `frontend/src/components/CustomerTimeline.tsx` (new)

---

## Phase 3: Lead-to-Customer Lifecycle & Navigation Structure

### 3.1 Navigation Structure Clarification
- **CRITICAL**: Separate navigation items in side menu:
  - **Discoveries** (`/discoveries`) - Unknowns, unqualified prospects from campaigns
  - **Leads** (`/leads`) - Working to convert to customers, qualified prospects
  - **Customers** (`/customers`) - Active customers being dealt with
- Leads and Customers have same capabilities (can create quotes for both)
- Update navigation menu to reflect three separate sections
- **Files**: `frontend/src/components/Layout.tsx` (update menu items), `frontend/src/App.tsx` (add routes)

### 3.2 Data Model Enhancements
- Add lead stage enums (New, Contacted, Qualified, Converted)
- Add conversion metadata fields to Customer model
- Add pipeline stage tracking
- Ensure Quote model supports both `customer_id` and `lead_id` (or add `lead_id` field)
- **Files**: `backend/app/models/crm.py` (extend), `backend/app/models/leads.py` (extend), `backend/app/models/quotes.py` (extend)

### 3.3 Discoveries Page (New)
- Create dedicated Discoveries page for unqualified prospects
- Display discoveries from campaigns (unknowns)
- Allow promotion of discoveries to leads
- **Files**: `frontend/src/pages/Discoveries.tsx` (new), `backend/app/api/v1/endpoints/discoveries.py` (new)

### 3.4 Lead Desk (Separate from Customers)
- Create dedicated Lead Desk page (not within Customers)
- Add kanban columns (New, Contacted, Qualified, Converted)
- Display AI-synthesized firmographics, intent signals, recommended outreach sequence
- Show blockers and quick stats
- **Files**: `frontend/src/pages/Leads.tsx` (extend), `frontend/src/components/LeadDesk.tsx` (new)

### 3.5 Conversion Control
- Add "Convert to Customer" CTA on customer detail when status is lead
- Validate required fields (contacts, address) before conversion
- Call conversion API to promote to CRM customer
- Log conversion and update both Customer and Lead records
- Preserve audit trail
- **Files**: `backend/app/api/v1/endpoints/customers.py` (extend), `frontend/src/pages/CustomerDetail.tsx` (extend)

### 3.6 Unified Stage & Pipeline Views
- Define canonical enums (Lead > Prospect > Opportunity > Customer > Active/Churn Risk)
- Provide pipeline views (kanban, funnel, heatmaps)
- Implement drag-and-drop stage transitions
- Add AI-derived probability and recommended next steps
- **Files**: `backend/app/models/crm.py` (extend), `frontend/src/components/PipelineView.tsx` (new)

### 3.7 Lead Intelligence & Sequencing
- AI generates summary of opportunity and risk for every lead
- Generate suggested outreach plan (email, call, meeting) with templates
- Show similar leads that recently converted and what quote/offer succeeded
- **Files**: `backend/app/services/lead_intelligence_service.py` (new), `frontend/src/pages/Leads.tsx` (extend)

### 3.8 Quote Creation for Leads
- Ensure quote creation works for both customers and leads
- Update quote creation UI to support lead selection
- Add `lead_id` field to Quote model if not exists
- **Files**: `frontend/src/pages/QuoteNew.tsx` (extend), `backend/app/models/quotes.py` (verify/extend), `backend/app/api/v1/endpoints/quotes.py` (extend)

---

## Phase 4: Next-Gen CPQ/Quoting

### 4.1 Data Model Updates
- Enhance QuoteVersion model with diffs, reviewer comments, timestamps, status
- Add approval workflow configuration
- Add quote pipeline stages (Draft, In Review, Sent, Negotiation, Won, Lost)
- **Files**: `backend/app/models/quotes.py` (extend), `backend/app/models/product.py` (extend QuoteVersion)

### 4.2 Quoting Workspace & Pipeline
- Replace static table with pipeline board showing deal counts, totals, warnings
- Add filters for sector, owner, margin
- Highlight SLA metrics (quote turnaround time)
- **Files**: `frontend/src/pages/Quotes.tsx` (extend), `frontend/src/components/QuotePipeline.tsx` (new)

### 4.3 Guided CPQ Builder with AI-Assisted Quote Assembly
- Convert QuoteNew into step-by-step builder:
  - **Quote Type Selection**: First step asks for quote type (IT/server, software build, cabling/wifi, etc.)
  - **Multi-Tenant AI Prompts**: System uses tenant-specific and industry-specific prompts to guide quote building
  - **AI Quote Assembly Prompts**: Multiple prompts per tenant based on:
    - Tenant industry (IT company, software company, cabling company, etc.)
    - Quote type selected
    - Each prompt assists in building complete quotes using:
      - **Day rates** (stored in system per tenant/user)
      - **Component pricing from suppliers** (supplier pricing data)
      - **Specs from vendors or AI knowledge** (product specifications, technical requirements)
  - Customer & opportunity selection with AI-suggested bundles
  - Product catalog search, drag/drop line items, bundles, subscription terms
  - Real-time margin, tax, and total calculations
  - Guardrails for discounts and required approvals
  - Automated labor/material estimation from templates or AI
- **Prompt Categories Needed**:
  - `QUOTE_BUILDER_IT_SERVER` - For IT companies quoting servers (RAM, storage specs)
  - `QUOTE_BUILDER_SOFTWARE` - For software companies quoting software builds
  - `QUOTE_BUILDER_CABLING` - For cabling companies quoting structured cabling/wifi installation
  - `QUOTE_BUILDER_GENERIC` - Generic quote builder prompt
  - Additional industry-specific prompts as needed
- **Files**: `frontend/src/pages/QuoteNew.tsx` (rewrite), `frontend/src/components/CPQBuilder.tsx` (new), `backend/app/services/quote_builder_ai_service.py` (new)

### 4.4 AI Co-pilot for Quotes
- During quote drafting, AI:
  - Summarizes scope and risks
  - Generates clarifying questions and recommended upsells
  - Suggests cross-sells based on customer industry and similar wins
  - Provides ready-to-send executive summaries and email copy
- **Files**: `backend/app/services/quote_ai_copilot_service.py` (new), `frontend/src/components/QuoteAICopilot.tsx` (new)

### 4.5 Quote Builder AI Prompt System
- **Multi-Tenant Quote Builder Prompts**: 
  - Store quote builder prompts per tenant with industry-specific variants
  - Prompt selection based on: `tenant_id` + `quote_type` + `industry`
  - Each prompt guides AI to build quotes using:
    - **Day rates from system** (tenant-specific day rates for different roles/skills)
    - **Component pricing from suppliers** (real-time supplier pricing data)
    - **Specs from vendors or AI knowledge** (technical specifications, product requirements)
- **Prompt Resolution Logic**:
  1. Tenant-specific prompt for quote type + industry (highest priority)
  2. Tenant-specific generic quote builder prompt
  3. System prompt for quote type + industry
  4. System generic quote builder prompt (fallback)
- **Data Sources for AI**:
  - Day rates: Query from `backend/app/models/pricing_config.py` or user/day_rate tables
  - Supplier pricing: Query from `backend/app/models/supplier.py` SupplierPricing
  - Product specs: Query from `backend/app/models/product.py` Product model
  - Vendor specs: Query from supplier product content history
- **AI Prompt Categories**:
  - Add to `PromptCategory` enum: `QUOTE_BUILDER_IT`, `QUOTE_BUILDER_SOFTWARE`, `QUOTE_BUILDER_CABLING`, `QUOTE_BUILDER_GENERIC`
  - Support custom quote types per tenant (extensible)
- **Files**: `backend/app/models/ai_prompt.py` (add quote builder categories), `backend/app/services/quote_builder_ai_service.py` (new), `backend/app/api/v1/endpoints/quotes.py` (add quote builder endpoint)

### 4.6 Versioning & Approvals
- Implement QuoteVersion entities with diffs, reviewer comments, timestamps
- Configurable approval workflows (by deal size, discount percent, region)
- UI showing approval ladder, pending approvers, escalate overdue approvals
- **Files**: `backend/app/api/v1/endpoints/quotes.py` (extend), `frontend/src/components/QuoteApprovalWorkflow.tsx` (new)

### 4.7 Sending, E-sign, and Handoff
- Integrated PDF/HTML generation
- Customer portal view with comment threads
- E-sign capture
- Track opened/viewed/signed events
- Trigger automation when signed (create project tasks, support contracts, welcome emails)
- Provide "Implementation checklist" on customer record once quote accepted
- **Files**: `backend/app/services/document_generator_service.py` (extend), `frontend/src/components/QuoteSendModal.tsx` (new)

---

## Phase 5: AI Insights & Trend Detection

### 5.1 Data Model for Insights
- Create TrendInsight model for storing cross-customer trends
- Create CustomerHealthDigest model for per-customer health monitoring
- Add anomaly alert model
- **Files**: `backend/app/models/insights.py` (new)

### 5.2 Per-Customer Health Monitoring
- Continuously review all tickets, quotes, leads for a given customer
- Produce issue trend summaries (recurring problems, rising SLA breaches)
- Track sentiment over time, satisfaction risk, recommended mitigations
- AI-authored "Customer Health Digest" displayed on customer detail
- Optional weekly email/Slack alerts
- **Files**: `backend/app/services/customer_health_service.py` (new), `frontend/src/components/CustomerHealthDigest.tsx` (new)

### 5.3 Cross-Customer Trend Detection
- Aggregate signals across tenants/customers to spot:
  - Recurring defects (same product issue across accounts)
  - Quote hurdles (e.g., supplier delays causing stalled approvals)
  - Emerging churn signals (ticket volume spikes, quote rejections)
- Render dashboards and proactive alerts when thresholds are met
- **Files**: `backend/app/services/trend_detection_service.py` (new), `frontend/src/pages/TrendsDashboard.tsx` (new)

### 5.4 Anomaly & Opportunity Alerts
- AI monitors data streams and creates alerts for anomalies
- Link alerts to recommended plays (notify CSM, spin up knowledge article, create global announcement)
- **Files**: `backend/app/services/anomaly_detection_service.py` (new), `frontend/src/components/AlertFeed.tsx` (new)

### 5.5 Feedback & Retraining Loop
- Collect agent feedback on AI diagnostics (helpful/unhelpful)
- Log explanations and confidence for compliance
- Surface "Why this insight?" tooltips
- **Files**: `backend/app/api/v1/endpoints/insights.py` (new), `frontend/src/components/InsightFeedback.tsx` (new)

---

## Phase 6: Platform Foundations

### 6.1 APIs & Streaming
- REST/WebSocket endpoints for AI analysis status
- Pipeline data endpoints
- Approval flow endpoints
- Streaming of trend insight generation
- **Files**: `backend/app/api/v1/endpoints/ai_analysis.py` (extend), `backend/app/api/v1/endpoints/websocket.py` (extend)

### 6.2 Observability & Metrics
- Real-time dashboards for SLA adherence, AI usage/acceptance, lead velocity
- Quote cycle time, CSAT, AI trend accuracy metrics
- Alerting hooks (email, Slack, Teams)
- **Files**: `backend/app/services/metrics_service.py` (new), `frontend/src/pages/AnalyticsDashboard.tsx` (new)

### 6.3 Governance & Security
- Role-based permissions for AI content vs. internal notes
- Audit logs for conversions/approvals/AI suggestions
- Data residency controls
- Explainability features
- **Files**: `backend/app/core/permissions.py` (extend), `backend/app/models/audit_log.py` (new)

### 6.4 Performance Optimization
- Redis caching for frequently accessed data
- Database indexes for slow queries
- Pagination for all list endpoints
- Lazy loading for customer detail tabs
- Image optimization and CDN integration
- **Files**: `backend/app/services/cache_service.py` (extend), database migration files

---

## Phase 7: UX & Frontend Implementation

### 7.1 UX Specs & Wireframes
- Create UX specs/wireframes for:
  - AI ticket composer
  - AI suggestion/action panels
  - Lead Desk
  - CPQ pipeline
  - Customer health digest widgets
  - Trend dashboards
- Define accessibility/copy guidelines
- **Files**: `docs/ux-specs/` (new directory)

### 7.2 Admin Portal - AI Prompt Management
- Create AI Prompts management page in admin portal
- CRUD operations for prompts (create, edit, delete)
- Version history view with rollback capability
- Tenant-specific prompt management (filter by tenant)
- Prompt testing interface (test prompt with sample data)
- **Files**: `admin-portal/src/views/AIPrompts.vue` (new), `admin-portal/src/views/AIPromptVersions.vue` (new), `admin-portal/src/views/AIPromptEditor.vue` (new)

### 7.3 Admin Portal - AI Provider Management
- Extend provider management to include Microsoft Copilot
- Provider configuration UI (API keys, settings, health status)
- Per-tenant provider key management
- Provider testing interface
- **Files**: `admin-portal/src/views/AIProviders.vue` (extend)

### 7.4 Helpdesk UI Upgrades
- Dual-pane composer
- AI action chips
- Knowledge side panel
- SLA indicators
- Automation macros
- Inline diff acceptance
- **Files**: `frontend/src/pages/Helpdesk.tsx`, `frontend/src/pages/TicketDetail.tsx` (major updates)

### 7.5 Lead Desk & Conversion Controls
- Lead Desk kanban on Leads page (separate from Customers)
- Conversion controls ensuring sync with Leads/Campaigns
- Consistent stage transitions
- **Files**: `frontend/src/pages/Leads.tsx` (major updates)

### 7.6 CPQ Experience
- Product catalog integration
- Line-item builder
- Margin guardrails
- Approval modals
- Version history
- PDF send/e-sign flows
- **Files**: `frontend/src/pages/Quotes.tsx`, `frontend/src/pages/QuoteNew.tsx`, `frontend/src/pages/QuoteDetail.tsx` (major updates)

### 7.7 AI Insights Surfaces
- Customer detail health digest cards
- Alert feed
- Trend charts
- Org-level dashboards for recurring issues, anomalies, recommendations
- Alert subscription controls (email/Slack)
- **Files**: `frontend/src/pages/CustomerDetail.tsx` (extend), `frontend/src/pages/TrendsDashboard.tsx` (new)

---

## Phase 8: Automation & Notifications

### 8.1 Wire Automation/Notifications
- SLA alerts
- AI follow-up reminders
- Quote expiry notifications
- Trend digests
- Ensure auditability/opt-outs
- **Files**: `backend/app/services/notification_service.py` (extend), `backend/app/core/celery_app.py` (extend)

### 8.2 Telemetry & Feedback Capture
- AI suggestion acceptance tracking
- Trend accuracy votes
- Lead conversion velocity
- Quote cycle time
- CSAT metrics
- Connect to dashboards and model retraining pipeline
- **Files**: `backend/app/services/telemetry_service.py` (new), `frontend/src/components/FeedbackWidget.tsx` (new)

---

## Implementation Order Recommendation

1. **Phase 0** (1-2 weeks): Complete foundation fixes
2. **Phase 1** (3-4 weeks): AI orchestration layer
   - 1.1 Multi-tenant prompt management (verify existing, add admin portal)
   - 1.2 Microsoft Copilot integration (critical for data control)
   - 1.3-1.5 Core orchestration services
3. **Phase 3.1** (1 week): Navigation structure (separate Discoveries, Leads, Customers)
4. **Phase 2** (4-6 weeks): AI Helpdesk enhancements
5. **Phase 3** (3-4 weeks): Lead-to-customer lifecycle (with separate navigation)
6. **Phase 4** (5-7 weeks): Next-gen CPQ (support quotes for leads, AI quote builder prompts)
7. **Phase 5** (4-5 weeks): AI insights & trends
8. **Phase 6** (2-3 weeks): Platform foundations
9. **Phase 7** (6-8 weeks): UX & frontend (parallel with backend)
   - Include admin portal AI prompt management
10. **Phase 8** (2-3 weeks): Automation & notifications

**Total Estimated Timeline: 7-10 months**

---

## Key Files to Create/Modify

### New Backend Services
- `backend/app/services/ai_orchestration_service.py` (tenant-aware)
- `backend/app/services/microsoft_copilot_service.py` (Microsoft Copilot integration)
- `backend/app/services/quote_builder_ai_service.py` (AI quote assembly with day rates, supplier pricing, specs)
- `backend/app/services/helpdesk_ai_service.py`
- `backend/app/services/sla_intelligence_service.py`
- `backend/app/services/activity_timeline_service.py`
- `backend/app/services/lead_intelligence_service.py`
- `backend/app/services/quote_ai_copilot_service.py`
- `backend/app/services/customer_health_service.py`
- `backend/app/services/trend_detection_service.py`
- `backend/app/services/anomaly_detection_service.py`
- `backend/app/services/metrics_service.py`
- `backend/app/services/telemetry_service.py`

### New Frontend Components
- `frontend/src/components/TicketComposer.tsx`
- `frontend/src/components/TicketKnowledgePanel.tsx`
- `frontend/src/components/CustomerTimeline.tsx`
- `frontend/src/components/LeadDesk.tsx`
- `frontend/src/components/PipelineView.tsx`
- `frontend/src/components/QuotePipeline.tsx`
- `frontend/src/components/CPQBuilder.tsx` (with quote type selection and AI prompts)
- `frontend/src/components/QuoteAICopilot.tsx`
- `frontend/src/components/QuoteApprovalWorkflow.tsx`
- `frontend/src/components/CustomerHealthDigest.tsx`
- `frontend/src/pages/TrendsDashboard.tsx`
- `frontend/src/components/AlertFeed.tsx`
- `frontend/src/pages/Discoveries.tsx` (new - separate from leads)

### New Admin Portal Components
- `admin-portal/src/views/AIPrompts.vue` (prompt CRUD)
- `admin-portal/src/views/AIPromptVersions.vue` (version history & rollback)
- `admin-portal/src/views/AIPromptEditor.vue` (prompt editor with testing)
- `admin-portal/src/views/AIProviders.vue` (extend with Microsoft Copilot)

### Model Extensions
- `backend/app/models/helpdesk.py` (add fields)
- `backend/app/models/crm.py` (add lead stages, conversion metadata)
- `backend/app/models/quotes.py` (add pipeline stages, verify/add lead_id support)
- `backend/app/models/ai_provider.py` (add ProviderType.MICROSOFT_COPILOT)
- `backend/app/models/ai_prompt.py` (verify tenant_id support, add quote builder categories)
- `backend/app/models/insights.py` (new)
- `backend/app/models/audit_log.py` (new)

---

## Critical Requirements Summary

### Multi-Tenant AI Prompts
- âœ… All prompts stored in database with `tenant_id`
- âœ… Versioning with rollback capability
- âœ… Admin portal management UI
- âœ… Quote builder prompts: multiple per tenant, industry-specific

### Microsoft Copilot
- âœ… Add as AI provider option
- âœ… Microsoft Graph integration
- âœ… Data control for customers

### Navigation Structure
- âœ… Discoveries (unknowns) - separate menu item
- âœ… Leads (converting) - separate menu item
- âœ… Customers (active) - separate menu item
- âœ… Quotes support both leads and customers

### Quote Builder AI System
- âœ… Quote type selection first step
- âœ… Multi-tenant, industry-specific prompts
- âœ… Uses day rates, supplier pricing, vendor specs
- âœ… Prompt resolution with fallback hierarchy

---

**IMPORTANT**: All agents MUST review this plan before starting any work. This is the authoritative source for v3.0.0+ development.

**Last Updated**: 2025-01-XX  
**Next Review**: After each major phase completion

